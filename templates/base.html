{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-title" content="Netfliz" />
    <title>{% block title %}Netfliz Clone{% endblock %}</title>
    <link rel="manifest" href="{% static 'manifest.json' %}" />
    <link rel="apple-touch-icon" href="{% static 'img/icons/icon-192.png' %}" />
    <link rel="stylesheet" href="{% static 'css/netflix.css' %}" />
  </head>
  <body class="{% block body_class %}{% endblock %}">
    <header class="hero">
      <div class="hero__brand">
        <a href="{% url 'stream:public-home' %}">netfliz</a>
      </div>
      <nav class="hero__nav">
        {% if user.is_authenticated %}
        <a class="logout-link" href="{% url 'logout' %}" title="Sair">
          <span aria-hidden="true">Sair</span>
        </a>
        {% else %}
        <a href="{% url 'login' %}">Entrar</a>
        <a href="{% url 'stream:owner-dashboard' %}">Propriet√°rio</a>
        <a href="{% url 'stream:support' %}">Suporte</a>
        {% endif %}
      </nav>
    </header>
    <main class="page">
      {% if messages %}
      <div class="messages">
        {% for message in messages %}
        <div class="message {{ message.tags }}">{{ message }}</div>
        {% endfor %}
      </div>
      {% endif %}
      {% block content %}{% endblock %}
    </main>
    <footer class="hero__footer"></footer>
    <script>
      (function () {
        const workerUrl = "{% static 'js/service-worker.js' %}";
        const registerServiceWorker = () => {
          if (!("serviceWorker" in navigator)) {
            return;
          }
          navigator.serviceWorker.register(workerUrl, { scope: "/" }).catch(() => {});
        };

        const keepAliveUrl = "{% url 'stream:pwa-heartbeat' %}";
        const keepAlive = () => {
          if (!keepAliveUrl) {
            return;
          }
          fetch(keepAliveUrl, { credentials: "same-origin" }).catch(() => {});
        };

        registerServiceWorker();

        const isStandalone =
          window.matchMedia("(display-mode: standalone)").matches ||
          window.navigator.standalone;
        if (isStandalone) {
          keepAlive();
          window.addEventListener("pageshow", keepAlive);
          setInterval(keepAlive, 1000 * 60 * 5);
        }
      })();
    </script>
  </body>
</html>
